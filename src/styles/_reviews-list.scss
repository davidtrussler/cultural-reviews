$image-size: 61px;
$image-size-xs: 77px;
$image-size-s: 95px;
$image-size-sm: 113px;
$image-size-m: 162px;
$image-size-lm: 182px;
$image-size-l: 207px;

$image-size-aligned: calc((100% - ($gutter * 3)) / 4);
$image-size-stacked: calc((100% - ($gutter * 2)) / 2);
$image-size-aligned-2-col: calc((100% - ($gutter * 2)) / 2);

@mixin listingImage($imageSize, $layout) {
  width: $imageSize;
  height: $imageSize;
  padding: 0;

  @supports(display: grid) {
    @if $layout == aligned {
      width: 100%;
      height: 0;
      padding: 0 0 100%;
    } @else {
      // @if $imageSize == $image-size-lm {
      //   width: $image-size-stacked-2-col;
      //   height: 0;
      //   padding-bottom: $image-size-stacked-2-col;
      // } @else {
        width: $image-size-stacked;
        height: 0;
        padding-bottom: $image-size-stacked;
      // }
    }
  }    
}

.reviews {
  margin: 1rem 0 0;

  .reviews__list {
  }

  .reviews__listing {
    background: aqua;

    @include clearfix;
  }

  .listing__item {
    display: -ms-grid;
    -ms-grid-columns: $image-size auto;;
    display: grid;
    grid-template-columns: $image-size-aligned auto;

    column-gap: $gutter;
    text-decoration: none;
  }

  .listing__image {
    -ms-grid-column: 1;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;

    @include listingImage($image-size, aligned);
  }

  .listing__content {
    -ms-grid-column: 2;
  }

  .content__medium {
    @include medium;
  }

  .content__title {
    @include title;
  }

  .content__extra {
    @include extra;
  }

  // Responsive layout

  // Baseline: 1 column, image/content aligned, image size: default

  @include respond-to($mq-xs) {
    // 2 columns, image/content stacked
    .reviews__listing {
      background: beige;

      display: inline-block;
      float: left;
      width: calc((100% - $gutter) / 2);

      &:nth-child(2n) {
        margin: 0 0 0 calc($gutter / 2);
      }

      &:nth-child(2n+1) {
        margin: 0 calc($gutter / 2) 0 0;
        clear: left;
      }
    }

    .listing__item {
      display: inline;
    }

    .listing__image {
      @include listingImage($image-size-xs, stacked);
    }
  }

  @include respond-to($mq-s) {
    // 2 columns, image/content stacked, image size: s
    .reviews__listing {
      background: coral;
    }

    .listing__image {
      @include listingImage($image-size-s, stacked);
    }
  }

  @include respond-to($mq-sm) {
    // 2 columns, image/content aligned, image size: s
    .reviews__listing {
      background: powderblue;
    }

    .listing__item {
      display: -ms-grid;
      -ms-grid-columns: $image-size-sm auto;
      display: grid;
      grid-template-columns: $image-size-aligned-2-col auto;
      column-gap: calc($gutter * 2);
    }

    .listing__image {
      @include listingImage($image-size-sm, aligned);
    }

    .listing__content {
      -ms-grid-column: 2;
      -ms-grid-row: 1;
    }
  }

  @include respond-to($mq-m) {
    // 2 columns, image/content aligned, image size: m
    .reviews__listing {
      background: peachpuff;
    }

    .listing__item {
      -ms-grid-columns: $image-size-m auto;
    }

    .listing__image {
      @include listingImage($image-size-m, aligned);
    }
  }

  @include respond-to($mq-lm, portrait) {
    // 2 columns, image/content aligned, image size: l
    .reviews__listing {
      background: khaki;
    }

    .listing__item {
      -ms-grid-columns: $image-size-lm auto;
    }

    .listing__image {
      @include listingImage($image-size-lm, aligned);
    }
  }

  @include respond-to($mq-l, portrait) {
    // 2 columns, image/content aligned, image size: xl
    .reviews__listing {
      background: rosybrown;
    }

    .listing__item {
      // display: -ms-grid;
      -ms-grid-columns: $image-size-l auto;
    }

    .listing__image {
      @include listingImage($image-size-l, aligned);
    }
  }

  @include respond-to($mq-lm, landscape) {
    // 4 columns, image/content stacked, image size: l
    .reviews__listing {
      background: skyblue;

      width: calc((100% - ($gutter * 3)) / 4);

      &:nth-child(4n) {
        margin: 0 0 0 calc($gutter / 2);
      }

      &:nth-child(4n+1) {
        margin: 0 calc($gutter / 2) 0 0;
        clear: left;
      }

      &:nth-child(4n+2) {
        margin: 0 calc($gutter / 2);
      }

      &:nth-child(4n+3) {
        margin: 0 calc($gutter / 2);
        clear: none;
      }
    }

    .listing__item {
      display: inline;
    }

    .listing__image {
      @include listingImage($image-size-lm, stacked);

      @supports(display:grid) {
        width: 100%;
        height: 0;
        padding: 0 0 100%;
      }
    }
  }

  @include respond-to($mq-l, landscape) {
    // 4 columns, image/content overlap, image size: full width
    .reviews__listing {
      background: mintcream;
    }

    .listing__item {
      display: grid;
      grid-template-columns: none;
      grid-template-rows: 1fr auto 1rem;
    }

    .listing__image {
      @include listingImage($image-size-l, stacked);
    }

    .listing__content {
      grid-column: 1 / 2;
      grid-row: 2 / 4;
    }

    @supports(grid-column: 1 / 2) {
      .content__wrapper {
        display: inline-block;
        padding: 0.5rem calc($gutter * 2);
        margin: 0 calc($gutter * 4);
        background: rgba(224, 224, 224, 0.875);
      }

      .listing__image {
        width: 100%;
        height: 0;
        padding: 0 0 100%;
        grid-column: 1 / 2;
        grid-row: 1 / 3;
      }
    }
  }
}
